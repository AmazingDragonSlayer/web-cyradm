<HTML
><HEAD
><TITLE
>Configuring MySQL</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="Postfix-Cyrus-Web-cyradm-HOWTO"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Getting and installing the software"
HREF="install.html"><LINK
REL="NEXT"
TITLE="Configuring PAM"
HREF="pam-config.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Postfix-Cyrus-Web-cyradm-HOWTO</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="install.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="pam-config.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="MYSQL-CONFIG">4. Configuring MySQL</H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="MYSQL-CONFIG-SECURING">4.1. Securing MySQL</H2
><P
>Because you are using MySQL to authenticate users, you need to restrict network access to Port 3306.</P
><P
>I suggest to just bind mysql to the loopback-interface 127.0.0.1. This makes sure nobody can connect to your
	MySQL-Daemon via the network.</P
><P
>	edit <TT
CLASS="FILENAME"
>/etc/init.d/mysql.server</TT
> and edit line 107 as following:</P
><P
>Original line:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$bindir/safe_mysqld --datadir=$datadir --pid-file=$pid_file&#38;</PRE
></FONT
></TD
></TR
></TABLE
><P
>Changed line:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$bindir/safe_mysqld --datadir=$datadir --pid-file=$pid_file \
--bind-address=127.0.0.1&#38;</PRE
></FONT
></TD
></TR
></TABLE
><P
>(Re-)start your MySQL-Daemon by issuing <B
CLASS="COMMAND"
>/etc/init.d/mysql.server start</B
></P
><P
>To ensure the configuration-change was successful issue: <B
CLASS="COMMAND"
>netstat -an|grep LISTEN</B
>. The 
	Output should be looking similar to this:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>bond:~ # netstat -an|grep LISTEN
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="MYSQL-CREATE-DB">4.2. Create the databases and tables</H2
><P
>Now we need to create the database and tables for postfix and web-cyradm and add a user to the 
		database</P
><P
>		Web-cyradm comes with two SQL-files: <TT
CLASS="FILENAME"
>insertuser.sql</TT
> and <TT
CLASS="FILENAME"
>create.sql</TT
>
		The first inserts the Database user to the database »mysql«, the second creates the database »mail« and
		the needed tables.</P
><P
>The password for the user "mail" in this example is "secret" please insert whatever 
		user and password you like</P
><P
>		First you must add the user by executing <B
CLASS="COMMAND"
>/usr/local/mysql/bin/mysql &#60; insertuser.sql</B
>
		After the new DB-user is successfully added, you need to reload mysql 
		with <B
CLASS="COMMAND"
>mysqladmin reload</B
>
		</P
><P
>To create the needed tables in the database:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/usr/local/mysql/bin/mysql mail -u mail -p &#60; \
/usr/local/apache/htdocs/web-cyradm/scripts/create.sql</PRE
></FONT
></TD
></TR
></TABLE
><P
>		Now lets populate our tables, and insert the first admin-user. This user is needed to login
		to Web-cyradm
		</P
><P
>		Execute <B
CLASS="COMMAND"
>/usr/local/mysql/bin/mysql mail -u mail -p</B
> And type the following SQL queries:
		</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>INSERT INTO adminuser (username, password) VALUES ('admin', 'test');
INSERT INTO domainadmin (domain_name,adminuser) VALUES ('*','admin');
INSERT INTO accountuser (username, password) VALUES ('cyrus', 'secret');</PRE
></FONT
></TD
></TR
></TABLE
><P
>The first query inserts the admin user into the database, the second one is needed that the cyrus user can
be authenticated, use the same password like defined in <TT
CLASS="FILENAME"
>/usr/local/apache/htdocs/web-cyradm/config.inc.php</TT
></P
><P
>Please note, this setup for web-cyradm is fully compatible with replex, another project. Please see  
<A
HREF="http://www.replex.org"
TARGET="_top"
>http://www.replex.org</A
>
for more details.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="install.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="pam-config.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Getting and installing the software</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Configuring PAM</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>