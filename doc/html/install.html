<HTML
><HEAD
><TITLE
>Getting and installing the software</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="Postfix-Cyrus-Web-cyradm-HOWTO"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Technologies"
HREF="tech.html"><LINK
REL="NEXT"
TITLE="Configuring MySQL"
HREF="mysql-config.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Postfix-Cyrus-Web-cyradm-HOWTO</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="tech.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="mysql-config.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="INSTALL">3. Getting and installing the software</H1
><P
>	Most of the software is included in your Linux distribution. SuSE is shipping Cyrus as far as I know since 7.1.
	Since SuSE 8.1, cyrus-imap 2.1 and sasl2 is included, but not yet tested for this setup.
	Redhat does not ship any cyrus software (7.3). </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="MYSQL-INSTALL">3.1. Getting and installing MySQL</H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN201">3.1.1. Download</H3
><P
>		Origin-Site: <A
HREF="http://www.mysql.com/downloads/"
TARGET="_top"
>http://www.mysql.com/downloads/</A
>
		</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN205">3.1.2. Building and installing</H3
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cd /usr/local
tar -xvzf mysql-3.23.51.tar.gz
cd mysql-3.23.51

./configure \
--prefix=/usr/local/mysql \
--enable-assembler \
--with-innodb

make
make install

/usr/local/mysql/bin/mysql_install_db
echo /usr/local/mysql/lib/mysql &#62;&#62; /etc/ld.so.conf
ldconfig

ln -s /usr/local/mysql/include/mysql /usr/include/mysql
ln -s /usr/local/mysql/lib/mysql /usr/lib/mysql</PRE
></FONT
></TD
></TR
></TABLE
><P
>For security-improvement add a mysql-user on your system i.e. "mysql", then</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>chown -R mysql /usr/local/mysql/var</PRE
></FONT
></TD
></TR
></TABLE
><P
>and change the line user=root to user=mysql in the file <TT
CLASS="FILENAME"
>/usr/local/mysql/bin/safe_mysqld</TT
>
	</P
><P
>	you may wish to start mysql automatically at boottime, copy 
	<TT
CLASS="FILENAME"
>/usr/local/mysql/share/mysql/mysql.server</TT
> to <TT
CLASS="FILENAME"
>/etc/init.d/</TT
>
	 for SuSE, for Redhat it is <TT
CLASS="FILENAME"
>/etc/rc.d/init.d</TT
> instead of <TT
CLASS="FILENAME"
>/etc/init.d/</TT
>. 
	Further you need to add Symlinks to <TT
CLASS="FILENAME"
>/etc/init.d/rc3.d</TT
> 
	for SuSE and <TT
CLASS="FILENAME"
>/etc/rc.d/rc3.d</TT
>
	</P
><P
>	The following example is for SuSE Linux and should be easily changed for Redhat and other Linux distributions and
	commercial Unixes.
	</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cp /usr/local/mysql/share/mysql/mysql.server /etc/init.d/
ln -s /etc/init.d/mysql.server /etc/init.d/rc3.d/S20mysql
ln -s /etc/init.d/mysql.server /etc/init.d/rc3.d/k08mysql</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="BERKELEY-DB">3.2. Getting and installing Berkely DB</H2
><P
>	The Berkely DB is a requirement for building Cyrus-SASL and Cyrus-IMAP. Some Systems comes with recent versions but without 
	the header files installed. Please see your distributors CD/DVD to check if you can install the headerfiles from a package.
	</P
><P
>The version that comes with GNU/Debian Linux is out of Date, you will need to compile most recent version instead.
	If you allready installed Berkely DB on your Debian Box, please fist uninstall the software to prevent conflicts.
	</P
><P
>It is also very important, that Cyrus-SASL and Cyrus-IMAP ist compiled with the same version of Berkely DB
	of else you can run into problems</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN226">3.2.1. Download Berkely DB</H3
><P
>	Origin-Site: <A
HREF="http://www.sleepycat.com/update/snapshot/db-4.0.14.tar.gz"
TARGET="_top"
>	http://www.sleepycat.com/update/snapshot/db-4.0.14.tar.gz</A
>
	</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN230">3.2.2. Builing and installing Berkeley DB</H3
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cd dist

./configure --prefix=/usr/local/bdb

make
make install

echo /usr/local/bdb/lib &#62;&#62; /etc/ld.so.conf

ldconfig</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CYRUS-INSTALL">3.3. Getting and installing Cyrus SASL and IMAP</H2
><P
>	Building Cyrus SASL and IMAP from source is not a easy task. There are some prerequisites to be fulfilled, and lots 
	of difficult authentication related stuff to be considered.
	</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN237">3.3.1. Download Cyrus SASL and Cyrus IMAP</H3
><P
>	Origin-Site: <A
HREF="ftp://ftp.andrew.cmu.edu/pub/cyrus-mail/cyrus-sasl-2.1.9.tar.gz"
TARGET="_top"
>ftp://ftp.andrew.cmu.edu/pub/cyrus-mail/cyrus-sasl-2.1.9.tar.gz</A
>
	</P
><P
>Origin-Site: <A
HREF="ftp://ftp.andrew.cmu.edu/pub/cyrus-mail/cyrus-imapd-2.1.9.tar.gz"
TARGET="_top"
>ftp://ftp.andrew.cmu.edu/pub/cyrus-mail/cyrus-imapd-2.1.9.tar.gz</A
>

	</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN243">3.3.2. Building and installing Cyrus SASL</H3
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>tar -xvzf cyrus-sasl-2.1.9.tar.gz
cd cyrus-sasl-2.1.9

./configure \
--enable-anon \
--enable-plain \
--enable-login \
--disable-krb4 \
--with-saslauthd=/var/run/saslauthd \
--with-pam \
--with-dblib=berkeley \
--with-bdb-libdir=/usr/local/bdb/lib \
--with-bdb-incdir=/usr/local/bdb/inlude \
--with-openssl-dir=/usr/local/ssl \
--with-plugindir=/usr/local/lib/sasl2


make
make install

mkdir -p /var/run/saslauthd

cd saslauthd
make testsaslauthd
cp testsaslauthd /usr/local/bin

ldconfig</PRE
></FONT
></TD
></TR
></TABLE
><P
>The SASL library is installed in <TT
CLASS="FILENAME"
>/usr/local/lib/sasl2</TT
> but some programs are expecting SASL in 
<TT
CLASS="FILENAME"
>/usr/lib/sasl2</TT
>. So it is a good idea to create a symlink:
 <B
CLASS="COMMAND"
>ln -s /usr/local/lib/sasl2 /usr/lib/sasl2</B
>.</P
><P
>The testsaslauthd program allows you to test the saslauthd, description follows later.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN251">3.3.3. Building Cyrus-IMAP</H3
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>tar -xvzf cyrus-imapd-2.1.9.tar.gz
cd cyrus-imapd-2.1.9

export CPPFLAGS="-I/usr/include/et" 

./configure \
--with-sasl=/usr/local/lib \
--with-perl \
--with-auth=unix \
--with-openssl=/usr/local/ssl \
--without-ucdsnmp

make depend
make
make install</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="ATSRTUPSCRIPT">3.3.4. Automatic startup script</H3
><P
>If you wish to start the Cyrus IMAP daemon automatically after booting, you need a startupscript. Place the following script 
in <TT
CLASS="FILENAME"
>/etc/init.d/</TT
> for Redhat it is <TT
CLASS="FILENAME"
>/etc/rc.d/init.d</TT
> instead of <TT
CLASS="FILENAME"
>/etc/init.d/</TT
>.</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#!/bin/bash
#
# Cyrus startup script

case "$1" in
    start)
        # Starting SASL saslauthdaemon
        /usr/local/sbin/saslauthd -a pam&#38;

        # Starting Cyrus IMAP Server
        /usr/cyrus/bin/master &#38;
        ;;

    stop)

        # Stopping SASL saslauthdaemon
        killall saslauthd

        # Stopping Cyrus IMAP Server
        killall /usr/cyrus/bin/master

        ;;

    *)
        echo "Usage: $0 {start|stop}"
        exit 1
        ;;

esac</PRE
></FONT
></TD
></TR
></TABLE
><P
>If I get the time, I'll provide a more sophisticated script, but this script works</P
><P
>Now create the Symlinks in the runlevel directory (SuSE):</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ln -s /etc/init.d/cyrus /etc/init.d/rc3.d/S20
ln -s /etc/init.d/cyrus /etc/init.d/rc3.d/K10</PRE
></FONT
></TD
></TR
></TABLE
><P
>For Redhat:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ln -s /etc/rc.d/init.d/cyrus /etc/rc.d/rc3.d/S20cyrus
ln -s /etc/rc.d/init.d/cyrus /etc/rc.d/rc3.d/K10cyrus</PRE
></FONT
></TD
></TR
></TABLE
><P
>Attn the distributors: W H E N  will all distributors use the same paths for the init script? thanks!</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="POSTFIX-INSTALL">3.4. Getting and installing Postfix</H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN269">3.4.1. Download</H3
><P
>                Origin-Site: <A
HREF="http://www.postfix.org/ftp-sites.html"
TARGET="_top"
>http://www.postfix.org/ftp-sites.html</A
>
                </P
><P
>If you want to use SMTP authentication, you need to download the latest snapshot release, version 1.1.11 
	does NOT work with sasl2. Use 1.1.11-20020928 or newer.

        </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN274">3.4.2. Creating a User-ID (UID) and Group-ID (GID) for postfix</H3
><P
>        Before you can build and install postfix you have to be sure a »postfix« and a »postdrop« groups and users
        exists on the System. First check for the groups. You can check this
        by <B
CLASS="COMMAND"
>grep postfix /etc/group</B
> and <B
CLASS="COMMAND"
>grep maildrop /etc/group</B
>
        </P
><P
>        If there are no such groups and users, you just create them. Search for a free nummeric UID and GID. In the
        following example I will use UID and GID 33333 for Postfix and 33335 for the maildrop UID and GID. This ID's
        are corresponding to other documents.
        </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>groupadd -g 33333 postfix
groupadd -g 33335 postdrop

useradd -u 33333 -g 33333 -d /dev/null -s /bin/false postfix</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN281">3.4.3. Building and installing</H3
><P
>        The following screen shows what you have to do, if you installed MySQL from source as described above.
        If you installed MySQL from a binary package such as rpm or deb, then you have to change the
        include and library-flags to -I/usr/include/mysql and -L/usr/lib/mysql.
        </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>tar -xvzf postfix-1.1.11-20020928.tar.gz

cd postfix-1.1.11-20020928

make makefiles 'CCARGS=-DHAS_MYSQL \
-I/usr/local/mysql/include/mysql -DUSE_SASL_AUTH \
-I/usr/local/include/sasl' 'AUXLIBS=-L/usr/local/mysql/lib/mysql \
-lmysqlclient -lz -lm -L/usr/local/lib -lsasl2'

make install</PRE
></FONT
></TD
></TR
></TABLE
><P
>During <B
CLASS="COMMAND"
>make install</B
> a few question are asked. Just pressing <B
CLASS="KEYCAP"
>Enter</B
> should
        match your needs. For Redhat users it could be useful to enter <TT
CLASS="FILENAME"
>/usr/local/share/man</TT
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="PAM-MYSQL-INSTALL">3.5. Getting and installing pam_mysql</H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN291">3.5.1. Download</H3
><P
>Origin-Site: <A
HREF="http://sourceforge.net/projects/pam-mysql/"
TARGET="_top"
>			http://sourceforge.net/projects/pam-mysql/</A
>
		</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN295">3.5.2. Installing</H3
><P
>	If you compiled MySQL by yourself, you need to create a symlink to the MySQL includes and libraries
	</P
><P
>Additionally there is a bug in the <TT
CLASS="FILENAME"
>Makefile</TT
> which you need to correct.
	Edit the file and replace as follow:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>old:

export LD_D=gcc -shared -Xlinker -x -L/usr/lib/mysql

new: 

export LD_D=gcc -shared -Xlinker -x -L/usr/lib/mysql -lz</PRE
></FONT
></TD
></TR
></TABLE
><P
>After customizing that file go ahead with compiling pam_mysql</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>tar -xvzf pam_mysql-0.4.7.tar.gz

cd pam_mysql

make

cp pam_mysql.so /lib/security

ln -s /tmp/mysql.sock /var/lib/mysql/mysql.sock</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="WEB-CYRADM-INSTALL">3.6. Getting and installing Web-cyradm</H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN305">3.6.1. Download</H3
><P
>                Origin-Site: <A
HREF="http://www.web-cyradm.org"
TARGET="_top"
>http://www.web-cyradm.org</A
>
                </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN309">3.6.2. Installing</H3
><P
>Web-cyradm is written in PHP. If you don't have a webserver with php installed, I like to refer to my 
	<A
HREF="http://www.delouw.ch/linux/apache.phtml"
TARGET="_top"
>Apache-Compile-HOWTO</A
>. That document describes how to
	set up Apache with PHP and other modules</P
><P
>I M P O R T A N T :  Since web-cyradm is under heavy development, it maybe does not work properly with
	PHP 4.2.1 or newer. Please edit your <TT
CLASS="FILENAME"
>/usr/local/lib/php.ini</TT
> and set »register_globals=On« to be sure
	it works. please report any bugs to web-cyradm@test.delouw.ch (after subscribing the list). </P
><P
>Since web-cyradm uses PEAR for its database abstraction, you will also need a recent copy of PEAR. This is included
	in recent PHP Versions. I strongly suggest to update PHP anyway to 4.2.3 because a lot of important bugs have been fixed.
	</P
><P
>An often error done is to forget to touch the logfile and change the owner to the UID that Apache use. This is 
	usually »nobody« or »wwwrun«.</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cd /usr/local/apache/htdocs

tar -xvzf web-cyradm-0.5.2.tar.gz

touch /var/log/web-cyradm.log
chown nobody /var/log/web-cyradm.log</PRE
></FONT
></TD
></TR
></TABLE
><P
>After unpacking web-cyradm move it to a place in your webservers DocumentRoot</P
><P
>This is all, now we need to configure the whole bunch of software</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="tech.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="mysql-config.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Technologies</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Configuring MySQL</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>